<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VulnLab Local</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="container">
    <h1>VulnLab (offline)</h1>
    <p class="muted">Тренировочный сайт с намеренно уязвимой логикой. Открывай <code>index.html</code> напрямую, сервер не нужен.</p>

    <section class="card">
      <h2>1) SQL Injection (симуляция)</h2>
      <p>
        Логин использует уязвимую проверку в стиле SQL: <code>username == '...' && password == '...'</code>.
        Ввод внедряется в условие без экранирования и выполняется через <code>eval</code>.
      </p>
      <div class="row">
        <input id="loginUser" placeholder="username" value="user" />
        <input id="loginPass" placeholder="password" type="password" />
        <button id="loginBtn">Войти</button>
      </div>
      <pre id="sqlPreview" class="code"></pre>
      <div id="loginResult" class="result"></div>
    </section>

    <section class="card">
      <h2>2) DOM XSS</h2>
      <p>Комментарий вставляется через <code>innerHTML</code> и проходит только слабую blacklist-фильтрацию.</p>
      <div class="row">
        <input id="commentInput" placeholder="Оставь комментарий" />
        <button id="commentBtn">Добавить</button>
      </div>
      <div id="comments" class="comments"></div>
    </section>

    <section class="card">
      <h2>3) Client-side auth bypass</h2>
      <p>
        Доступ к "админке" проверяется только по объекту сессии в <code>localStorage.sessionData</code>.
        Это можно подменить через встроенную консоль ниже (без DevTools).
      </p>
      <div class="row">
        <button id="openAdminBtn">Открыть админ-панель</button>
        <button id="logoutBtn">Сбросить роль</button>
      </div>
      <div id="adminPanel" class="admin hidden">
        <strong>Admin panel:</strong> Секретные данные: <code>FLAG{local-demo-only}</code>
      </div>
    </section>

    <section class="card">
      <h2>4*) IDOR (задача со звездочкой)</h2>
      <p>
        Просмотр заявок должен быть только для владельца, но проверка прав доступа реализована неверно.
      </p>
      <div class="row">
        <input id="orderIdInput" placeholder="ID заявки (пример: ORD-1001)" value="ORD-1001" />
        <button id="viewOrderBtn">Открыть заявку</button>
      </div>
      <pre id="orderResult" class="code"></pre>
    </section>

    <section class="card">
      <h2>5) Reflected DOM XSS (hash)</h2>
      <p>
        Баннер читает значение из <code>location.hash</code> и вставляет его в DOM через
        <code>innerHTML</code>.
      </p>
      <div class="row">
        <input id="noticeInput" placeholder="Текст баннера для #notice=" />
        <button id="applyNoticeBtn">Записать в hash</button>
      </div>
      <div id="noticeBanner" class="code"></div>
    </section>

    <section class="card">
      <h2>6) Mass Assignment (JSON import)</h2>
      <p>
        Импорт профиля применяет JSON-объект к сессии через <code>Object.assign</code> без whitelist полей.
      </p>
      <textarea id="profileJsonInput" rows="4" placeholder='{"nickname":"student"}'>{"nickname":"student"}</textarea>
      <div class="row">
        <button id="importProfileBtn">Импортировать профиль</button>
      </div>
      <pre id="profileImportResult" class="code"></pre>
    </section>

    <section class="card">
      <h2>7) Path Traversal (симуляция)</h2>
      <p>
        Просмотрщик шаблонов читает виртуальные файлы. Защита от <code>../</code> проверяет путь до декодирования.
      </p>
      <div class="row">
        <input id="filePathInput" placeholder="templates/welcome.txt" value="templates/welcome.txt" />
        <button id="readFileBtn">Открыть шаблон</button>
      </div>
      <pre id="fileReadResult" class="code"></pre>
    </section>

    <section class="card">
      <h2>8*) Prototype Pollution (deep merge)</h2>
      <p>
        JSON настроек сливается кастомной рекурсивной функцией. Проверка не фильтрует служебные ключи.
      </p>
      <textarea id="settingsJsonInput" rows="4" placeholder='{"theme":{"accent":"lime"}}'>{"theme":{"accent":"lime"}}</textarea>
      <div class="row">
        <button id="applySettingsBtn">Применить настройки</button>
        <button id="checkPollutionBtn">Проверить эффект</button>
      </div>
      <pre id="settingsResult" class="code"></pre>
    </section>

    <section class="card">
      <h2>Встроенная консоль браузера</h2>
      <p>Мини-консоль для выполнения JS-команд прямо в странице.</p>
      <div class="row">
        <input id="consoleInput" placeholder="Введи JS-команду" />
        <button id="consoleRunBtn">Выполнить</button>
        <button id="consoleClearBtn">Очистить вывод</button>
      </div>
      <pre id="consoleOutput" class="console-output"></pre>
    </section>

    <section class="card">
      <h2>Подсказки (без готовых payload)</h2>
      <ol>
        <li>SQLi: подумай, как закрыть кавычку и добавить свое логическое условие.</li>
        <li>XSS: фильтрация режет не все теги, особенно если использовать события элементов.</li>
        <li>Bypass роли: нужное поле роли лежит внутри JSON в <code>localStorage</code>, а не отдельным ключом.</li>
        <li>4* IDOR: зайди под обычным пользователем и попробуй читать не свои заявки, меняя только ID.</li>
        <li>5) Hash XSS: посмотри, что происходит со значением после <code>#notice=</code>.</li>
        <li>6) Mass Assignment: импорт профиля принимает любые поля, не только отображаемые.</li>
        <li>7) Traversal: проверка ищет <code>../</code> до декодирования пути.</li>
        <li>8*) Prototype Pollution: поищи служебный ключ, который влияет на прототипы объектов.</li>
      </ol>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
